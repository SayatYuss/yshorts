# 1. Базовый образ
# Берем официальный образ Python. 'slim' — это облегченная версия.
FROM python:3.11-slim

# 2. Установка системных зависимостей
# Устанавливаем ffmpeg, который нужен для createVideo.py
RUN apt-get update && apt-get install -y \
    ffmpeg \
    && rm -rf /var/lib/apt/lists/*

# 3. Установка рабочей директории
# Все последующие команды будут выполняться в /app внутри контейнера
WORKDIR /app

# 4. Копирование файла зависимостей и их установка
# Копируем сначала только этот файл, чтобы Docker мог кэшировать
# установленные библиотеки, если они не менялись.
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# 5. Копирование кода приложения
# Копируем скрипт бота и папку с модулями
COPY bot.py .
COPY src/ ./src/

# 6. Создание директорий
# Создаем папки, которые использует приложение
RUN mkdir -p tmp results

# 7. Команда по умолчанию для запуска контейнера
# Эта команда выполнится, когда контейнер запустится
CMD ["python", "bot.py"]